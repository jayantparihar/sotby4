{"ast":null,"code":"import _readOnlyError from \"/home/azureuser/sotby2.0/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/readOnlyError\";\nimport _slicedToArray from \"/home/azureuser/sotby2.0/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"/home/azureuser/sotby2.0/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"/home/azureuser/sotby2.0/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/home/azureuser/sotby2.0/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/azureuser/sotby2.0/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/azureuser/sotby2.0/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/azureuser/sotby2.0/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/azureuser/sotby2.0/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/azureuser/sotby2.0/app/src/components/NoCollision_Year.jsx\";\nimport React from \"react\";\nimport RGL, { WidthProvider } from \"react-grid-layout\";\nimport _ from \"lodash\";\nimport TimelineGrid from \"./TimelineGrid\";\nimport { Link } from 'react-router-dom';\nimport { ReactSession } from 'react-client-session';\nvar ReactGridLayout = WidthProvider(RGL);\nvar LocalStorageLayout = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(LocalStorageLayout, _React$PureComponent);\n  function LocalStorageLayout(_ref) {\n    var _this;\n    var props = _ref.props,\n      socket = _ref.socket,\n      heightLimit = _ref.heightLimit,\n      newInstructorArray = _ref.newInstructorArray,\n      weekInformation = _ref.weekInformation,\n      firstDate = _ref.firstDate,\n      totalWeeks = _ref.totalWeeks;\n    _classCallCheck(this, LocalStorageLayout);\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LocalStorageLayout).call(this, props));\n    _this.replaceItem = function (item) {\n      for (var i = 0; i < _this.state.layout.length; i++) {\n        if (_this.state.layout[i].i === item.i) {\n          var newLayout = _this.state.layout.slice();\n          newLayout[i] = item;\n          _this.setState({\n            layout: newLayout\n          });\n          break;\n        }\n      }\n    };\n    _this.onLayoutChange = function (layout, layouts) {\n      _this.setState({\n        layout: layout\n      });\n    };\n    _this.onItemChange = function (layout, oldItem, newItem) {\n      // Update the dates on the postgresql database\n      var startDate = findWeekDate(_this.state.weekInformation, newItem.x);\n      var endDate = findWeekDate(_this.state.weekInformation, newItem.w + newItem.x - 1);\n      // HTTP request instead of sockets\n\n      var index = _.findIndex(_this.state.items, function (element) {\n        return element.data.i.toString() === newItem.i;\n      });\n      var foundItem = _this.state.items[index];\n\n      // Restrict movement of the course to one row only\n      var yAxisLockedItem = newItem;\n      yAxisLockedItem.y = oldItem.y;\n      _this.replaceItem(yAxisLockedItem);\n      var instructor = _this.state.instructorArray[Math.floor(newItem.y / 2)];\n      _this.socket.emit('itemChanged', yAxisLockedItem, {\n        username: instructor.key,\n        courseNum: foundItem.courseNum,\n        caId: foundItem.caId,\n        start: startDate.getTime(),\n        end: endDate.getTime()\n      });\n    };\n    _this.onAddVacation = function (info) {\n      var start = findWeekIndex(_this.state.weekInformation, new Date(info.start_date));\n      var end = findWeekIndex(_this.state.weekInformation, new Date(info.end_date)) + 1;\n      var index = _.findIndex(_this.state.instructorArray, function (element) {\n        return element.key === info.username;\n      });\n      var newVacation = {\n        text: info.username + \"'s Vacation\",\n        uid: info.username,\n        vid: info.vacation_id,\n        data: {\n          i: info.username + info.vacation_id,\n          x: start,\n          y: index * 2 + 1,\n          w: end - start,\n          h: 1\n        }\n      };\n      _this.setState({\n        items: _this.state.items.concat(newVacation)\n      });\n    };\n    _this.onAddCourse = function (course) {\n      var x = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var emit = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n      var w = parseInt(course.weeklength);\n      var startDate = findWeekDate(_this.state.weekInformation, x);\n      var endDate = findWeekDate(_this.state.weekInformation, w + x - 1);\n      var instructor = _this.state.instructorArray[Math.floor(y / 2)];\n\n      // User/ instructor was deleted, can't create a course\n      if (instructor === undefined) {\n        return;\n      }\n      if (emit) {\n        _this.socket.emit('courseAdded', _objectSpread({}, course, {\n          x: x,\n          y: y,\n          instructorKey: instructor.key,\n          courseNum: course.number,\n          start: startDate.getTime(),\n          end: endDate.getTime()\n        }));\n      } else {\n        _this.setState({\n          // Add a new item\n          items: _this.state.items.concat({\n            text: course.title,\n            userId: instructor.key,\n            courseNum: course.number,\n            caId: course.caId,\n            data: {\n              i: course.caId,\n              x: x,\n              y: y,\n              w: w,\n              h: 1\n            }\n          })\n        });\n      }\n    };\n    _this.onRemoveUser = function (key, y) {\n      var initialLength = _this.state.instructorArray.length;\n      _this.setState({\n        instructorArray: _.reject(_this.state.instructorArray, function (element) {\n          return element.key === key;\n        })\n      }, function () {\n        // No user/ instructor found to delete\n        if (_this.state.instructorArray.length !== initialLength) {\n          // Remove elements on the same row\n          console.log(\"Removed items at: \" + y);\n          _this.setState({\n            items: _.reject(_this.state.items, function (element) {\n              return element.data.y === y || element.data.y === y + 1;\n            })\n          }, function () {\n            // Move course elements up if they are below the user that was deleted\n            _this.setState({\n              items: _.reduce(_this.state.items, function (acc, element) {\n                if (element.data.y > y) {\n                  var newElement = element;\n                  newElement.data.y -= 2;\n                  return [].concat(_toConsumableArray(acc), [newElement]);\n                } else {\n                  return [].concat(_toConsumableArray(acc), [element]);\n                }\n              }, [])\n            }, function () {\n              _this.setState({\n                layout: _.reduce(_this.state.items, function (acc, element) {\n                  if (element.vid !== undefined) {\n                    var itemData = _objectSpread({}, element.data, {\n                      isDraggable: false,\n                      isResizable: false\n                    });\n                    return [].concat(_toConsumableArray(acc), [itemData]);\n                  } else {\n                    var _itemData = element.data;\n                    return [].concat(_toConsumableArray(acc), [_itemData]);\n                  }\n                }, [])\n              });\n            });\n          });\n          // Reset layout so that the items are shifted up visually\n        }\n      });\n    };\n    _this.onAddUser = function (user) {\n      _this.setState({\n        instructorArray: [].concat(_toConsumableArray(_this.state.instructorArray), [{\n          key: user.username,\n          name: user.firstname + \" \" + user.lastname,\n          timeblocks: [],\n          vacations: []\n        }])\n      });\n    };\n    var weeks_since_first_week = getWeeksPerMonth(firstDate);\n    _this.state = {\n      // Loop through the instructor array to get all the courses associated with them\n      items: newInstructorArray.reduce(function (acc, element, index) {\n        if (element.timeblocks.length === 0 && element.vacations.length === 0 || weekInformation.length === 0) {\n          return acc;\n        }\n\n        // Create a course element for every timeblock and concatenate them into one array\n        var arr = acc.concat(element.timeblocks.map(function (info) {\n          var start = Math.floor(getDayRange(firstDate, info.start) / 7);\n          var end = Math.floor((getDayRange(firstDate, info.end) + 1) / 7);\n          var weekMonday = getWeekMonday(info.start);\n          var week_start = getDayRange(weekMonday, info.start);\n          var week_end = getDayRange(weekMonday, info.end) + 1;\n          var width_in_week = getCourseWidthWeek(week_start, week_end, weekMonday, firstDate);\n          var item_month = info.start.getMonth();\n          return {\n            start: start,\n            end: end,\n            start_date: info.start,\n            text: info.name,\n            caId: info.caId,\n            userId: info.userId,\n            courseNum: info.courseNum,\n            weekWidth: width_in_week,\n            data: {\n              i: info.caId,\n              x: weeks_since_first_week[item_month] + getWeekIndex(info.start),\n              y: index * 2,\n              w: 1,\n              h: 1\n            }\n          };\n        }));\n        return arr.concat(element.vacations.map(function (info) {\n          var start = Math.floor(getDayRange(firstDate, info.vacationStart) / 7);\n          var end = Math.floor((getDayRange(firstDate, info.vacationEnd) + 1) / 7);\n          var width = getVacationWidth(info.vacationStart, start, end, firstDate);\n          return {\n            start: start,\n            end: end,\n            start_date: info.vacationStart,\n            text: element.name + \"'s Vacation\",\n            uid: info.userId,\n            vid: info.vacationId,\n            data: {\n              i: info.userId + info.vacationId,\n              x: start,\n              y: index * 2 + 1,\n              w: width,\n              h: 1\n            }\n          };\n        }));\n      }, []),\n      heightLimit: heightLimit.get,\n      weekInformation: weekInformation,\n      instructorArray: newInstructorArray,\n      weeks_since_first_week: weeks_since_first_week\n    };\n    _this.socket = socket;\n    _this.heightLimit = heightLimit;\n    _this.totalWeeks = totalWeeks;\n    _this.filteredItems = _this.state.items;\n\n    // this.socket.on(\"itemChanged\", (item) => {\n    //   console.log(\"Item Received: \" + JSON.stringify(item));\n\n    //   this.replaceItem(item);\n    // });\n\n    // this.socket.on(\"courseAdded\", (item) => {\n    //   console.log(\"Item Received: \" + JSON.stringify(item));\n\n    //   this.onAddCourse(item, parseInt(item.x), parseInt(item.y), false);\n    // });\n\n    // this.socket.on(\"courseDeleted\", (i) => {\n    //   console.log(\"Item Received: \" + JSON.stringify(i));\n\n    //   this.onRemoveItem(i, false);\n    // });\n\n    // this.socket.on(\"vacationApproved\", (vacation) => {\n    //   console.log(\"Item Received: \" + JSON.stringify(vacation));\n\n    //   this.onAddVacation(vacation);\n    // });\n\n    // this.socket.on(\"vacationDeleted\", (vacation) => {\n    //   console.log(\"Item Received: \" + JSON.stringify(vacation));\n\n    //   this.onRemoveVacation(vacation.vacation_id, false);\n    // })\n    return _this;\n  }\n  _createClass(LocalStorageLayout, [{\n    key: \"onRemoveItem\",\n    value: function onRemoveItem(i) {\n      var emit = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      // Find the index of the course element in the state\n      var index = _.findIndex(this.state.items, function (element) {\n        return element.data.i === i;\n      });\n      var foundItem = this.state.items[index];\n\n      // Emit a message to all other applications that a course has been edeleted\n      if (emit) {\n        this.socket.emit(\"courseDeleted\", foundItem, i);\n      }\n\n      // Remove the element from the state\n      this.setState({\n        items: _.reject(this.state.items, function (element) {\n          return element.data.i === i;\n        })\n      });\n    }\n  }, {\n    key: \"onRemoveVacation\",\n    value: function onRemoveVacation(vid) {\n      var emit = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      if (emit) {\n        this.socket.emit(\"vacationDeleted\", {\n          vacation_id: vid\n        });\n      }\n\n      // Remove the element from the state\n      this.setState({\n        items: _.reject(this.state.items, function (element) {\n          return element.vid === vid;\n        })\n      });\n    }\n  }, {\n    key: \"createElement\",\n    value: function createElement(el) {\n      var isVacation = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var removeStyle = {\n        position: \"absolute\",\n        right: \"2px\",\n        top: 0,\n        cursor: \"pointer\",\n        padding: \"5px\",\n        color: \"black\"\n      };\n      var dsStyle = {\n        position: \"absolute\",\n        left: \"2px\",\n        bottom: 0,\n        cursor: \"pointer\",\n        padding: \"5px\",\n        color: \"black\"\n      };\n      return /*#__PURE__*/React.createElement(\"div\", {\n        key: el.data.i,\n        \"data-grid\": isVacation ? _objectSpread({}, el.data, {\n          isDraggable: false,\n          isResizable: false\n        }) : el.data,\n        name: el.text + \" el\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"text\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 319,\n          columnNumber: 9\n        }\n      }, el.text), !isVacation && ReactSession.get(\"admin\") === 1 ? /*#__PURE__*/React.createElement(Link, {\n        to: {\n          pathname: \"/detailed-schedule\",\n          search: \"?courseNum=\" + el.courseNum\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        className: \"remove\",\n        style: dsStyle,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 13\n        }\n      }, \"Detailed\")) : undefined);\n    }\n  }, {\n    key: \"getMonthWeekAmount\",\n    value: function getMonthWeekAmount(currentDate) {\n      var new_date = new Date(currentDate);\n      new_date.setMonth(new_date.getMonth() + 1);\n      new_date.setDate(0);\n      var last_day_of_month = new_date.getDate();\n      var week_day_index = new_date.getDay();\n      if (week_day_index === 0) {\n        week_day_index = 7;\n      }\n      var week_amount = Math.floor((last_day_of_month - week_day_index) / 7) + 1;\n      return week_amount;\n    }\n  }, {\n    key: \"filterItems\",\n    value: function filterItems() {\n      var _this2 = this;\n      var course_lengths = {};\n      var weeks_since_first_week = getWeeksPerMonth(this.props.firstDate);\n      var items = this.state.items.filter(function (item) {\n        var item_month = item.start_date.getMonth();\n        var start = item.start;\n        var width = weeks_since_first_week[item_month] + getWeekIndex(item.start_date);\n        if (typeof item.vid === 'number') {\n          width = getVacationWidth(item.start_date, item.start, item.end, _this2.props.firstDate);\n        }\n        if (width === 0) {\n          return false;\n        }\n        if (typeof item.courseNum === 'number') {\n          if (item.userId in course_lengths) {\n            if (start in course_lengths[item.userId]) {\n              if (item.courseNum in course_lengths[item.userId][start]) {\n                course_lengths[item.userId][start][item.courseNum] = course_lengths[item.userId][start][item.courseNum] + item.weekWidth;\n              } else {\n                course_lengths[item.userId][start][item.courseNum] = item.weekWidth;\n              }\n            } else {\n              course_lengths[item.userId][start] = {};\n              course_lengths[item.userId][start][item.courseNum] = item.weekWidth;\n            }\n          } else {\n            course_lengths[item.userId] = {};\n            course_lengths[item.userId][start] = {};\n            course_lengths[item.userId][start][item.courseNum] = item.weekWidth;\n          }\n        }\n        return true;\n      });\n      for (var user_id in course_lengths) {\n        for (var week in course_lengths[user_id]) {\n          var course_amounts = Object.values(course_lengths[user_id][week]);\n          for (var course_num in course_lengths[user_id][week]) {\n            if (course_lengths[user_id][week][course_num] === Math.max.apply(Math, course_amounts)) {\n              course_lengths[user_id][week] = course_num;\n            } else {\n              delete course_lengths[user_id][week][course_num];\n            }\n          }\n        }\n      }\n      items = items.filter(function (item) {\n        if (typeof item.courseNum === 'number') {\n          if (item.courseNum === Number(course_lengths[item.userId][item.start])) {\n            if (_this2.props.firstDate.getFullYear() === item.start_date.getFullYear()) {\n              delete course_lengths[item.userId][item.start];\n              return true;\n            }\n          } else {\n            return false;\n          }\n        } else {\n          return true;\n        }\n      });\n      items = items.map(function (item) {\n        var item_month = item.start_date.getMonth();\n        item.data.x = weeks_since_first_week[item_month] + getWeekIndex(item.start_date);\n        item.data.w = getVacationWidth(item.start_date, item.start, item.end, _this2.props.firstDate);\n        return item;\n      });\n      this.filteredItems = items;\n      console.log('item', items);\n      // this.itemLayout = items;\n\n      return items;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n      var total_weeks = 0;\n      var month_date = new Date(this.props.firstDate);\n      for (var month_index = 0; month_index < 12; month_index++) {\n        month_date.setMonth(month_index);\n        total_weeks = total_weeks + Number(this.getMonthWeekAmount(month_date));\n      }\n      this.filterItems();\n      return /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 448,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(TimelineGrid, {\n        socket: this.socket,\n        heightLimit: this.heightLimit,\n        instructorArray: this.state.instructorArray,\n        createCourse: this.onAddCourse,\n        totalWeeks: total_weeks,\n        onRemoveUser: this.onRemoveUser,\n        onAddUser: this.onAddUser,\n        viewType: \"years\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 449,\n          columnNumber: 9\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"grid-item-container-year\",\n        style: {\n          width: this.totalWeeks * 102,\n          position: \"absolute\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 458,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(ReactGridLayout, Object.assign({}, this.props, {\n        cols: this.totalWeeks,\n        maxRows: this.state.heightLimit(),\n        layout: this.state.layout,\n        onLayoutChange: this.onLayoutChange,\n        onResizeStop: this.onItemChange,\n        onDragStop: this.onItemChange,\n        isDraggable: false,\n        isResizable: false,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 459,\n          columnNumber: 11\n        }\n      }), this.filteredItems.map(function (el) {\n        return _this3.createElement(el, el.vid !== undefined ? true : false);\n      }))));\n    }\n  }]);\n  return LocalStorageLayout;\n}(React.PureComponent);\nLocalStorageLayout.defaultProps = {\n  className: \"layout\",\n  rowHeight: 100,\n  margin: [2, 2],\n  allowOverlap: true,\n  preventCollision: false,\n  resizeHandles: ['e'],\n  compactType: null,\n  autoSize: true\n};\nexport { LocalStorageLayout as default };\nfunction findWeekIndex(weekInformation, date) {\n  // Search for a week in a particular month\n  var monthIndex = date.getMonth();\n\n  // Get the first day of every week in that month\n  var weekRanges = weekInformation.weekRangesArray[monthIndex].times;\n  for (var i = 0; i < weekRanges.length; i++) {\n    if (date <= weekRanges[i].date) {\n      return weekRanges[i].index;\n    }\n  }\n\n  // Return the index of the last week of the month\n  return weekRanges[weekRanges.length - 1].index;\n}\nfunction findWeekDate(weekInformation, index) {\n  return weekInformation.indexMap[index];\n}\n\n// made this new function. im sure there is a better way. \nfunction getCourseWidthWeek(start, end, currentDate, firstDate) {\n  // monday and friday = how many days they are from jan 3 2022. if the dates for monday and friday are in 2021 they are negative. \n  var _getMonFri = getMonFri(currentDate, firstDate),\n    _getMonFri2 = _slicedToArray(_getMonFri, 2),\n    monday = _getMonFri2[0],\n    friday = _getMonFri2[1]; // start and end values are in the same format as monday and friday.\n  // course is an incremented array of 'day values'\n  var course = _.range(start, end);\n  // week is an incremented array of 'day values'\n  var week = _.range(monday, friday + 1);\n  // intersect is an array of all the values the week and course share.\n  var intersection = course.filter(function (value) {\n    return week.includes(value);\n  });\n\n  // this counts the array. now you have a width\n  return intersection.length;\n}\n\n// this function gets how many days apart the current view's monday and friday are from jan 3 2022\nfunction getMonFri(currentDate, firstDate) {\n  var new_date = new Date(currentDate);\n  var monday = new_date.getDate();\n  var friday = monday + 4;\n  if (typeof firstDate !== 'undefined' && firstDate !== 'nothing :D') {\n    var new_monday = getDayRange(firstDate, currentDate);\n    var new_friday = getDayRange(firstDate, currentDate) + 4;\n    return [new_monday, new_friday];\n  } else {\n    return [monday, friday];\n  }\n}\n\n// gets the amount of days between two dates\nfunction getDayRange(d1, d2) {\n  return Math.round((d2.getTime() - d1.getTime()) / (1000 * 3600 * 24));\n}\nfunction getWeekMonday(currentDate) {\n  var current_date = new Date(currentDate);\n  var current_date_weekday = currentDate.getDay();\n  if (current_date_weekday >= 1) {\n    current_date.setDate(currentDate.getDate() - (current_date_weekday - 1));\n  } else {\n    current_date.setDate(currentDate.getDate() - 6);\n  }\n  return current_date;\n}\nfunction getWeekDayIndex(date) {\n  if (date.getDay() == 0) {\n    return 6;\n  } else {\n    return date.getDay() - 1;\n  }\n}\nfunction getWeekIndex(date) {\n  var week_day_index = getWeekDayIndex(date);\n  var day_of_month = date.getDate();\n  if (day_of_month > week_day_index) {\n    var week_index = Math.floor((day_of_month - week_day_index - 1) / 7);\n    return week_index;\n  } else {\n    var new_date = new Date(date);\n    new_date.setDate(0);\n    var last_day_of_prev_month = new_date.getDate();\n    var _week_index = Math.floor((day_of_month + last_day_of_prev_month - week_day_index - 1) / 7);\n    return _week_index;\n  }\n}\nfunction getWeeksPerMonth(first_date) {\n  var first_date_year = first_date.getFullYear();\n  var week_date = new Date(first_date);\n  var weeks_per_month = [0];\n  var count = 0;\n  while (week_date.getFullYear() === first_date_year) {\n    var week_date_month = week_date.getMonth();\n    week_date.setDate(week_date.getDate() + 7);\n    if (week_date_month === week_date.getMonth()) {\n      count = count + 1;\n    } else {\n      count = count + 1;\n      weeks_per_month.push(count);\n    }\n  }\n  return weeks_per_month;\n}\nfunction getVacationWidth(start_date, start_index, end_index, first_date) {\n  var week_day_index = getWeekDayIndex(start_date);\n  var day_of_month = start_date.getDate();\n  var first_date_year = first_date.getFullYear();\n  var width = end_index - start_index + 1;\n  if (start_index > end_index) {\n    end_index - start_index + 1, _readOnlyError(\"width\");\n  }\n  if (start_date.getFullYear() == first_date_year) {\n    return width;\n  } else {\n    return 0;\n  }\n}","map":{"version":3,"names":["React","RGL","WidthProvider","_","TimelineGrid","Link","ReactSession","ReactGridLayout","LocalStorageLayout","props","socket","heightLimit","newInstructorArray","weekInformation","firstDate","totalWeeks","replaceItem","item","i","state","layout","length","newLayout","slice","setState","onLayoutChange","layouts","onItemChange","oldItem","newItem","startDate","findWeekDate","x","endDate","w","index","findIndex","items","element","data","toString","foundItem","yAxisLockedItem","y","instructor","instructorArray","Math","floor","emit","username","key","courseNum","caId","start","getTime","end","onAddVacation","info","findWeekIndex","Date","start_date","end_date","newVacation","text","uid","vid","vacation_id","h","concat","onAddCourse","course","parseInt","weeklength","undefined","instructorKey","number","title","userId","onRemoveUser","initialLength","reject","console","log","reduce","acc","newElement","itemData","isDraggable","isResizable","onAddUser","user","name","firstname","lastname","timeblocks","vacations","weeks_since_first_week","getWeeksPerMonth","arr","map","getDayRange","weekMonday","getWeekMonday","week_start","week_end","width_in_week","getCourseWidthWeek","item_month","getMonth","weekWidth","getWeekIndex","vacationStart","vacationEnd","width","getVacationWidth","vacationId","get","filteredItems","el","isVacation","removeStyle","position","right","top","cursor","padding","color","dsStyle","left","bottom","pathname","search","currentDate","new_date","setMonth","setDate","last_day_of_month","getDate","week_day_index","getDay","week_amount","course_lengths","filter","user_id","week","course_amounts","Object","values","course_num","max","Number","getFullYear","total_weeks","month_date","month_index","getMonthWeekAmount","filterItems","createElement","PureComponent","defaultProps","className","rowHeight","margin","allowOverlap","preventCollision","resizeHandles","compactType","autoSize","date","monthIndex","weekRanges","weekRangesArray","times","indexMap","getMonFri","monday","friday","range","intersection","value","includes","new_monday","new_friday","d1","d2","round","current_date","current_date_weekday","getWeekDayIndex","day_of_month","week_index","last_day_of_prev_month","first_date","first_date_year","week_date","weeks_per_month","count","week_date_month","push","start_index","end_index"],"sources":["/home/azureuser/sotby2.0/app/src/components/NoCollision_Year.jsx"],"sourcesContent":["import React from \"react\";\nimport RGL, { WidthProvider } from \"react-grid-layout\";\nimport _ from \"lodash\";\nimport TimelineGrid from \"./TimelineGrid\";\nimport { Link } from 'react-router-dom';\nimport { ReactSession } from 'react-client-session';\nconst ReactGridLayout = WidthProvider(RGL);\n\n\nexport default class LocalStorageLayout extends React.PureComponent {\n  static defaultProps = {\n    className: \"layout\",\n    rowHeight: 100,\n    margin: [2, 2],\n    allowOverlap: true,\n    preventCollision: false,\n    resizeHandles: ['e'],\n    compactType: null,\n    autoSize: true\n  };\n\n  constructor({ props, socket, heightLimit, newInstructorArray, weekInformation, firstDate, totalWeeks }) {\n    super(props);\n\n    const weeks_since_first_week = getWeeksPerMonth(firstDate)\n    this.state = {\n      // Loop through the instructor array to get all the courses associated with them\n      items: newInstructorArray.reduce(function (acc, element, index) {\n        if ((element.timeblocks.length === 0 && element.vacations.length === 0) || weekInformation.length === 0) {\n          return acc;\n        }\n\n        // Create a course element for every timeblock and concatenate them into one array\n        let arr = acc.concat(\n          element.timeblocks.map((info) => {\n            const start = Math.floor((getDayRange(firstDate, info.start)) / 7);\n            const end = Math.floor((getDayRange(firstDate, info.end) + 1) / 7);\n            \n            const weekMonday = getWeekMonday(info.start);\n            const week_start = getDayRange(weekMonday, info.start);\n            const week_end = getDayRange(weekMonday, info.end) + 1;\n            const width_in_week = getCourseWidthWeek(week_start, week_end, weekMonday, firstDate);\n            \n            const item_month = info.start.getMonth();\n            return (\n              {\n                start: start,\n                end: end,\n                start_date: info.start,\n                text: info.name,\n                caId: info.caId,\n                userId: info.userId,\n                courseNum: info.courseNum,\n                weekWidth: width_in_week,\n                data: {\n                  i: info.caId,\n                  x: weeks_since_first_week[item_month] + getWeekIndex(info.start),\n                  y: index * 2,\n                  w: 1,\n                  h: 1,\n                }\n              }\n            )\n          })\n        );\n\n        return arr.concat(\n          element.vacations.map((info) => {\n            const start = Math.floor((getDayRange(firstDate, info.vacationStart)) / 7);\n            const end = Math.floor((getDayRange(firstDate, info.vacationEnd) + 1) / 7);\n            const width = getVacationWidth(info.vacationStart, start, end, firstDate);\n            return (\n              {\n                start: start,\n                end: end,\n                start_date: info.vacationStart,\n                text: element.name + \"'s Vacation\",\n                uid: info.userId,\n                vid: info.vacationId,\n                data: {\n                  i: info.userId + info.vacationId,\n                  x: start,\n                  y: (index * 2) + 1,\n                  w: width,\n                  h: 1,\n                }\n              }\n            )\n          })\n        );\n      }, []),\n      heightLimit: heightLimit.get,\n      weekInformation: weekInformation,\n      instructorArray: newInstructorArray,\n      weeks_since_first_week: weeks_since_first_week\n    };\n    this.socket = socket;\n    this.heightLimit = heightLimit;\n    this.totalWeeks = totalWeeks;\n    this.filteredItems = this.state.items;\n\n    // this.socket.on(\"itemChanged\", (item) => {\n    //   console.log(\"Item Received: \" + JSON.stringify(item));\n\n    //   this.replaceItem(item);\n    // });\n\n    // this.socket.on(\"courseAdded\", (item) => {\n    //   console.log(\"Item Received: \" + JSON.stringify(item));\n\n    //   this.onAddCourse(item, parseInt(item.x), parseInt(item.y), false);\n    // });\n\n    // this.socket.on(\"courseDeleted\", (i) => {\n    //   console.log(\"Item Received: \" + JSON.stringify(i));\n\n    //   this.onRemoveItem(i, false);\n    // });\n\n    // this.socket.on(\"vacationApproved\", (vacation) => {\n    //   console.log(\"Item Received: \" + JSON.stringify(vacation));\n\n    //   this.onAddVacation(vacation);\n    // });\n\n    // this.socket.on(\"vacationDeleted\", (vacation) => {\n    //   console.log(\"Item Received: \" + JSON.stringify(vacation));\n\n    //   this.onRemoveVacation(vacation.vacation_id, false);\n    // })\n  }\n\n  replaceItem = (item) => {\n    for (let i = 0; i < this.state.layout.length; i++) {\n      if (this.state.layout[i].i === item.i) {\n        const newLayout = this.state.layout.slice();\n        newLayout[i] = item;\n\n        this.setState({\n          layout: newLayout\n        });\n\n        break;\n      }\n    }\n  }\n\n  onLayoutChange = (layout, layouts) => {\n    this.setState({\n      layout: layout\n    });\n  }\n\n  onItemChange = (layout, oldItem, newItem) => {\n    // Update the dates on the postgresql database\n    const startDate = findWeekDate(this.state.weekInformation, newItem.x);\n    const endDate = findWeekDate(this.state.weekInformation, newItem.w + newItem.x - 1);\n    // HTTP request instead of sockets\n\n    const index = _.findIndex(this.state.items, (element) => { return element.data.i.toString() === newItem.i });\n    const foundItem = this.state.items[index];\n\n    // Restrict movement of the course to one row only\n    const yAxisLockedItem = newItem;\n    yAxisLockedItem.y = oldItem.y;\n    this.replaceItem(yAxisLockedItem);\n\n    const instructor = this.state.instructorArray[Math.floor(newItem.y / 2)];\n    this.socket.emit('itemChanged', yAxisLockedItem, { username: instructor.key, courseNum: foundItem.courseNum, caId: foundItem.caId, start: startDate.getTime(), end: endDate.getTime() });\n  }\n\n  onAddVacation = (info) => {\n    const start = findWeekIndex(this.state.weekInformation, new Date(info.start_date));\n    const end = findWeekIndex(this.state.weekInformation, new Date(info.end_date)) + 1;\n    const index = _.findIndex(this.state.instructorArray, (element) => { return element.key === info.username });\n\n    const newVacation = {\n      text: info.username + \"'s Vacation\",\n      uid: info.username,\n      vid: info.vacation_id,\n      data: {\n        i: info.username + info.vacation_id,\n        x: start,\n        y: (index * 2) + 1,\n        w: end - start,\n        h: 1,\n      }\n    }\n\n    this.setState({\n      items: this.state.items.concat(\n        newVacation\n      )\n    });\n  }\n\n  onAddCourse = (course, x = 0, y = 0, emit = true) => {\n    const w = parseInt(course.weeklength);\n\n    const startDate = findWeekDate(this.state.weekInformation, x);\n    const endDate = findWeekDate(this.state.weekInformation, w + x - 1);\n    const instructor = this.state.instructorArray[Math.floor(y / 2)];\n\n    // User/ instructor was deleted, can't create a course\n    if (instructor === undefined) {\n      return;\n    }\n\n    if (emit) {\n      this.socket.emit('courseAdded', { ...course, x: x, y: y, instructorKey: instructor.key, courseNum: course.number, start: startDate.getTime(), end: endDate.getTime() });\n    } else {\n      this.setState({\n        // Add a new item\n        items: this.state.items.concat({\n          text: course.title,\n          userId: instructor.key,\n          courseNum: course.number,\n          caId: course.caId,\n          data: {\n            i: course.caId,\n            x: x,\n            y: y,\n            w: w,\n            h: 1,\n          }\n        }),\n      });\n    }\n  }\n\n  onRemoveItem(i, emit = true) {\n    // Find the index of the course element in the state\n    const index = _.findIndex(this.state.items, (element) => { return element.data.i === i });\n    const foundItem = this.state.items[index];\n\n    // Emit a message to all other applications that a course has been edeleted\n    if (emit) {\n      this.socket.emit(\"courseDeleted\", foundItem, i);\n    }\n\n    // Remove the element from the state\n    this.setState({ items: _.reject(this.state.items, (element) => { return element.data.i === i }) });\n  }\n\n  onRemoveVacation(vid, emit = true) {\n    if (emit) {\n      this.socket.emit(\"vacationDeleted\", { vacation_id: vid });\n    }\n\n    // Remove the element from the state\n    this.setState({ items: _.reject(this.state.items, (element) => { return element.vid === vid }) });\n  }\n\n  onRemoveUser = (key, y) => {\n    const initialLength = this.state.instructorArray.length;\n    this.setState({ instructorArray: _.reject(this.state.instructorArray, (element) => { return element.key === key }) },\n      () => {\n        // No user/ instructor found to delete\n        if (this.state.instructorArray.length !== initialLength) {\n          // Remove elements on the same row\n          console.log(\"Removed items at: \" + y);\n          this.setState({ items: _.reject(this.state.items, (element) => { return element.data.y === y || element.data.y === y + 1 }) }\n            , () => {\n              // Move course elements up if they are below the user that was deleted\n              this.setState({\n                items: _.reduce(this.state.items, (acc, element) => {\n                  if (element.data.y > y) {\n                    const newElement = element;\n                    newElement.data.y -= 2;\n                    return [...acc, newElement];\n                  } else {\n                    return [...acc, element];\n                  }\n                }, [])\n              },\n                () => {\n                  this.setState({\n                    layout: _.reduce(this.state.items, (acc, element) => {\n                      if (element.vid !== undefined) {\n                        const itemData = { ...element.data, isDraggable: false, isResizable: false };\n                        return [...acc, itemData];\n                      } else {\n                        const itemData = element.data;\n                        return [...acc, itemData];\n                      }\n                    }, [])\n                  });\n                });\n            });\n          // Reset layout so that the items are shifted up visually\n        }\n      });\n  }\n\n  onAddUser = (user) => {\n    this.setState({ instructorArray: [...this.state.instructorArray, { key: user.username, name: user.firstname + \" \" + user.lastname, timeblocks: [], vacations: [] }] });\n  }\n\n  createElement(el, isVacation = false) {\n    const removeStyle = {\n      position: \"absolute\",\n      right: \"2px\",\n      top: 0,\n      cursor: \"pointer\",\n      padding: \"5px\",\n      color: \"black\"\n    };\n    const dsStyle = {\n      position: \"absolute\",\n      left: \"2px\",\n      bottom: 0,\n      cursor: \"pointer\",\n      padding: \"5px\",\n      color: \"black\"\n    };\n\n    return (\n      <div key={el.data.i} data-grid={isVacation ? { ...el.data, isDraggable: false, isResizable: false } : el.data} name={el.text + \" el\"} >\n        <span className=\"text\">{el.text}</span>\n        {!isVacation && ReactSession.get(\"admin\") === 1 ?\n          <Link\n            to={{\n              pathname: \"/detailed-schedule\",\n              search: \"?courseNum=\" + el.courseNum,\n            }}\n          >\n            <span\n              className=\"remove\"\n              style={dsStyle}\n            >\n              Detailed\n            </span>\n          </Link>\n          :\n          undefined\n        }\n      </div>\n    );\n  }\n\n  getMonthWeekAmount(currentDate) {\n    const new_date = new Date(currentDate)\n    new_date.setMonth(new_date.getMonth() + 1)\n    new_date.setDate(0)\n    const last_day_of_month = new_date.getDate()\n    let week_day_index = new_date.getDay()\n    if (week_day_index === 0) {\n      week_day_index = 7\n    }\n    const week_amount = Math.floor((last_day_of_month - week_day_index) / 7) + 1\n    return week_amount\n  }\n\n  filterItems() {\n    \n    let course_lengths = {};\n    const weeks_since_first_week = getWeeksPerMonth(this.props.firstDate)\n\n    var items = this.state.items.filter((item) => {\n      const item_month = item.start_date.getMonth();\n      const start = item.start;\n      let width = weeks_since_first_week[item_month] + getWeekIndex(item.start_date)\n      if (typeof item.vid === 'number') {\n        width = getVacationWidth(item.start_date, item.start, item.end, this.props.firstDate);\n      }\n      if (width === 0) {\n        return false\n      }\n      if (typeof item.courseNum === 'number') {\n        \n        if (item.userId in course_lengths) {\n          if (start in course_lengths[item.userId]) {\n            if (item.courseNum in course_lengths[item.userId][start]) {\n              course_lengths[item.userId][start][item.courseNum] = course_lengths[item.userId][start][item.courseNum] + item.weekWidth\n            } else {\n              course_lengths[item.userId][start][item.courseNum] = item.weekWidth\n            }\n          } else {\n            course_lengths[item.userId][start] = {}\n            course_lengths[item.userId][start][item.courseNum] = item.weekWidth\n          }\n        } else {\n          course_lengths[item.userId] = {}\n          course_lengths[item.userId][start] = {}\n          course_lengths[item.userId][start][item.courseNum] = item.weekWidth\n        }\n      }\n      return true;\n    })\n    \n    for (const user_id in course_lengths) {\n      \n      for (const week in course_lengths[user_id]) {\n        const course_amounts = Object.values(course_lengths[user_id][week])\n\n        for (const course_num in course_lengths[user_id][week]) {\n          if (course_lengths[user_id][week][course_num] === Math.max(...course_amounts)) {\n            course_lengths[user_id][week] = course_num\n          \n          } else {\n            delete course_lengths[user_id][week][course_num]\n          \n          }\n        }\n      }\n    }\n    \n    items = items.filter((item) => {\n      if (typeof item.courseNum === 'number') {\n        if (item.courseNum === Number(course_lengths[item.userId][item.start])) {\n          if (this.props.firstDate.getFullYear() === item.start_date.getFullYear()) {\n            delete course_lengths[item.userId][item.start]\n            return true\n          }\n        } else {\n          return false\n        }\n      } else {\n        return true\n      }\n    })\n\n    items = items.map((item) => {\n      const item_month = item.start_date.getMonth();\n      item.data.x = weeks_since_first_week[item_month] + getWeekIndex(item.start_date)\n      item.data.w = getVacationWidth(item.start_date, item.start, item.end, this.props.firstDate);\n      return item\n    })\n\n    this.filteredItems = items;\n    console.log('item', items)\n    // this.itemLayout = items;\n\n    return items;\n  }\n  \n\n  render() {\n\n    let total_weeks = 0\n    let month_date = new Date(this.props.firstDate)\n    for (let month_index = 0; month_index < 12; month_index++) {\n      month_date.setMonth(month_index)\n      total_weeks = total_weeks + Number(this.getMonthWeekAmount(month_date))\n    }\n    this.filterItems()\n    return (\n      <React.Fragment>\n        <TimelineGrid\n          socket={this.socket}\n          heightLimit={this.heightLimit}\n          instructorArray={this.state.instructorArray}\n          createCourse={this.onAddCourse}\n          totalWeeks={total_weeks}\n          onRemoveUser={this.onRemoveUser}\n          onAddUser={this.onAddUser} \n          viewType={\"years\"}/>\n        <div className=\"grid-item-container-year\" style={{ width: this.totalWeeks * 102, position: \"absolute\" }}>\n          <ReactGridLayout\n            {...this.props}\n            cols={this.totalWeeks}\n            maxRows={this.state.heightLimit()}\n            layout={this.state.layout}\n            onLayoutChange={this.onLayoutChange}\n            onResizeStop={this.onItemChange}\n            onDragStop={this.onItemChange}\n            isDraggable={false}\n            isResizable={false}\n          >\n            {this.filteredItems.map(el => this.createElement(el, el.vid !== undefined ? true : false))}\n          </ReactGridLayout>\n        </div>\n      </React.Fragment>\n    );\n  }\n}\n\nfunction findWeekIndex(weekInformation, date) {\n  // Search for a week in a particular month\n  const monthIndex = date.getMonth();\n\n  // Get the first day of every week in that month\n  const weekRanges = weekInformation.weekRangesArray[monthIndex].times;\n\n  for (let i = 0; i < weekRanges.length; i++) {\n    if (date <= weekRanges[i].date) {\n      return weekRanges[i].index;\n    }\n\n  }\n\n  // Return the index of the last week of the month\n  return weekRanges[weekRanges.length - 1].index;\n}\n\nfunction findWeekDate(weekInformation, index) {\n  return weekInformation.indexMap[index];\n}\n\n\n// made this new function. im sure there is a better way. \nfunction getCourseWidthWeek(start, end, currentDate, firstDate) {\n  // monday and friday = how many days they are from jan 3 2022. if the dates for monday and friday are in 2021 they are negative. \n\n  let [monday, friday] = getMonFri(currentDate, firstDate)\n\n  // start and end values are in the same format as monday and friday.\n  // course is an incremented array of 'day values'\n  const course = _.range(start, end)\n  // week is an incremented array of 'day values'\n  const week = _.range(monday, friday + 1)\n  // intersect is an array of all the values the week and course share.\n  const intersection = course.filter(value => week.includes(value));\n  \n  // this counts the array. now you have a width\n  return intersection.length\n\n}\n\n\n// this function gets how many days apart the current view's monday and friday are from jan 3 2022\nfunction getMonFri(currentDate, firstDate) {\n  const new_date = new Date(currentDate)\n  const monday = new_date.getDate()\n  const friday = monday + 4\n\n  if ((typeof firstDate !== 'undefined') && (firstDate !== 'nothing :D')){\n    let new_monday = getDayRange(firstDate, currentDate)\n    let new_friday = getDayRange(firstDate, currentDate) + 4\n\n    return [new_monday, new_friday]\n  } else {\n    return [monday, friday]\n  }\n}\n\n// gets the amount of days between two dates\nfunction getDayRange(d1, d2) {\n  \n  return Math.round((d2.getTime() - d1.getTime()) / (1000 * 3600 * 24))\n}\n\n\nfunction getWeekMonday(currentDate) {\n  const current_date = new Date(currentDate)\n  const current_date_weekday = currentDate.getDay()\n  if (current_date_weekday >= 1) {\n    current_date.setDate(currentDate.getDate() - (current_date_weekday - 1))\n  } else {\n    current_date.setDate(currentDate.getDate() - 6)\n  }\n  return current_date\n}\n\nfunction getWeekDayIndex(date) {\n  if (date.getDay() == 0) {\n    return 6\n  } else {\n    return date.getDay() - 1\n  }\n}\n\nfunction getWeekIndex(date) {\n  const week_day_index = getWeekDayIndex(date)\n  const day_of_month = date.getDate()\n  if (day_of_month > week_day_index) {\n    const week_index = Math.floor((day_of_month - week_day_index - 1) / 7)\n    return week_index\n  } else {\n    const new_date = new Date(date)\n    new_date.setDate(0)\n    const last_day_of_prev_month = new_date.getDate()\n    const week_index = Math.floor((day_of_month + last_day_of_prev_month - week_day_index - 1) / 7)\n    return week_index\n  }\n}\n\nfunction getWeeksPerMonth(first_date) {\n  const first_date_year = first_date.getFullYear()\n  let week_date = new Date(first_date)\n  \n  let weeks_per_month = [0]\n  let count = 0\n  while (week_date.getFullYear() === first_date_year) {\n    const week_date_month = week_date.getMonth()\n    week_date.setDate(week_date.getDate() + 7)\n    if (week_date_month === week_date.getMonth()) {\n      count = count + 1\n    } else {\n      count = count + 1\n      weeks_per_month.push(count)\n    }\n  }\n  return weeks_per_month\n}\n\nfunction getVacationWidth(start_date, start_index, end_index, first_date) {\n  const week_day_index = getWeekDayIndex(start_date)\n  const day_of_month = start_date.getDate()\n  const first_date_year = first_date.getFullYear()\n  const width = end_index - start_index + 1\n  if (start_index > end_index) {\n    width = end_index - start_index + 1\n  }\n  if (start_date.getFullYear() == first_date_year) {\n    return width\n\n  } else {\n    return 0\n  }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}